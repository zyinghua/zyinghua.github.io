document.addEventListener("DOMContentLoaded",(function(){MathJax.startup.promise.then((function(){document.querySelectorAll(".complex-math").forEach((function(e){const t=/\[([^\]]+)\]\(([^)]+)\)/g;let a=e.innerHTML;a=a.replace(t,(function(e,t,a){return'<a href="'+a+'">'+t+"</a>"})),a=a.replace(/^(#{1,6})\s+(.+?)$/gm,(function(e,t,a){const n=t.length;return`</p><h${n}>${a}</h${n}><p>`})),a=a.replace(/(<img[^>]*>)\s*\*([^*]+)\*/g,(function(e,t,a){return'<div class="figure-container" style="margin-top:2em;">'+t+'<div class="figure-caption">'+a+"</div></div>"})),a.includes("<p>")&&!a.includes("</p><h")||(a=a.replace(/(\$\$[\s\S]+?\$\$)\s*\n\s*(\$\$[\s\S]+?\$\$)/g,'$1\n<span class="math-separator" style="height:0.4em; display:block;"></span>\n$2'),a=a.replace(/(?<!<\/p>)\n\s*\n/g,"</p><p>"),a.startsWith("<p>")||a.startsWith("</p><h")||(a="<p>"+a),a.endsWith("</p>")||(a+="</p>"),a=a.replace(/<\/p><\/p>/g,"</p>"),a=a.replace(/<p><p>/g,"<p>"),a=a.replace(/<\/p><h([1-6])>/g,"</p><h$1>"),a=a.replace(/<\/h([1-6])><p><\/p>/g,"</h$1><p>"),a=a.replace(/<\/h([1-6])><p>/g,"</h$1><p>")),e.innerHTML=a,MathJax.typesetPromise([e]).then((function(){const t=e.querySelectorAll(".MathJax_Display, .mjx-chtml");for(let e=0;e<t.length-1;e++){const a=t[e],n=t[e+1];let r=a.nextSibling,i=!0,l=0;for(;r&&r!==n;){if(1===r.nodeType){if("BR"===r.tagName){if(l++,l>1){i=!1;break}}else if("SPAN"!==r.tagName||!r.classList.contains("math-separator")){i=!1;break}}else if(3===r.nodeType&&""!==r.textContent.trim()){i=!1;break}r=r.nextSibling}i&&n.classList.add("consecutive-math")}t.forEach((function(e){let t=e.nextElementSibling;for(;t;){if("IMG"===t.tagName){t.style.marginTop="2em";break}if(t.classList.contains("figure-container")){t.style.marginTop="2em";break}if("BR"!==t.tagName&&!t.classList.contains("math-separator"))break;t=t.nextElementSibling}}));e.querySelectorAll("p").forEach((function(e){if(e.textContent.trim().length>200&&e.querySelector(".MathJax, .mjx-chtml")){e.style.overflowX="visible",e.style.width="100%",e.style.boxSizing="border-box",e.style.wordWrap="break-word",e.style.overflowWrap="break-word";e.querySelectorAll(".MathJax_Display, .mjx-chtml.MJXc-display").forEach((function(e){e.style.maxWidth="100%",e.style.overflowX="auto"}))}}))}))}))}))}));